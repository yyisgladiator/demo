image: jecb96/isabelle:2018

cache:
  key: "$CI_COMMIT_REF_SLUG"
  paths:
    - cache/

stages:
  - dependency
  - mustWork
  - canFail


before_script:
  - if [ ! -z "$(ls -A cache)" ]; then mv cache/* /home/isabelle/.isabelle; fi
  - find /home/isabelle/.isabelle

after_script:
  - find /home/isabelle/.isabelle
  - rm -rf cache/*
  - mv /home/isabelle/.isabelle/* cache/



#####################################
## Test Jobs
#####################################

## Look in the "ROOT" file to see the sessions and add files


dependency:
  stage: dependency
  script:
    - isabelle build -D . -j2 -o timeout_scale=1.8 -n -v || if [ $? -eq 1 ]; then exit 0; else exit $?; fi


mustWork:
  stage: mustWork
  script:
    - find /home/isabelle/.isabelle
    - isabelle build -d . -j2 -o timeout_scale=1.8 -v -b -g mustWork


canFail:
  stage: canFail
  allow_failure: true   #for now, sorrys are allowed
  script:
    - isabelle build -d . -j2 -o timeout_scale=1.8 -v -b -g canFail
